{"version":3,"file":"errors.js","names":["ApiTimeout","Error","constructor","Object","setPrototypeOf","new","target","prototype","http_code","name","exports","AuthenticationError","message","ActionNotAllowed","UrlAlreadyRegistered","error","body","NotFoundError","ErrorWithBody","ValidationError","TooManyRequestsError","BadGateway","ApiError","ValueError","determineError","_ref","_asyncToGenerator","err","type","errorJSON","json","undefined","keys","length","code","status","_x","apply","arguments"],"sources":["../../src/services/errors.js"],"sourcesContent":["/* eslint-disable camelcase */\r\n/* eslint-disable max-classes-per-file */\r\n/**\r\n * Error raised for pre-api value validation\r\n *\r\n * @export\r\n * @class ApiTimeout\r\n * @extends {Error}\r\n */\r\nexport class ApiTimeout extends Error {\r\n    constructor() {\r\n        super('ApiTimeout');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 408;\r\n        this.name = 'ApiTimeout';\r\n    }\r\n}\r\n\r\n/**\r\n * AuthenticationError\r\n *\r\n * @export\r\n * @class AuthenticationError\r\n * @extends {Error}\r\n */\r\nexport class AuthenticationError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 401;\r\n        this.name = 'AuthenticationError';\r\n    }\r\n}\r\n\r\n/**\r\n * ActionNotAllowed\r\n *\r\n * @export\r\n * @class ActionNotAllowed\r\n * @extends {Error}\r\n */\r\nexport class ActionNotAllowed extends Error {\r\n    constructor(message = 'ActionNotAllowed') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 403;\r\n        this.name = 'ActionNotAllowed';\r\n    }\r\n}\r\n\r\n/**\r\n * UrlAlreadyRegistered\r\n *\r\n * @export\r\n * @class UrlAlreadyRegistered\r\n * @extends {Error}\r\n */\r\nexport class UrlAlreadyRegistered extends Error {\r\n    constructor(error, message = 'UrlAlreadyRegistered') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 409;\r\n        this.name = 'UrlAlreadyRegistered';\r\n        this.body = error;\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * NotFoundError\r\n *\r\n * @export\r\n * @class NotFoundError\r\n * @extends {Error}\r\n */\r\nexport class NotFoundError extends Error {\r\n    constructor(message = 'NotFoundError') {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.http_code = 404;\r\n        this.name = 'NotFoundError';\r\n    }\r\n}\r\n\r\n/**\r\n * ValidationError\r\n *\r\n * @export\r\n * @class ValidationError\r\n * @extends {Error}\r\n */\r\nexport class ErrorWithBody extends Error {\r\n    constructor(http_code, error, message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = message;\r\n        this.http_code = http_code;\r\n        this.body = error;\r\n    }\r\n}\r\n\r\n/**\r\n * ValidationError\r\n *\r\n * @export\r\n * @class ValidationError\r\n * @extends {ErrorWithBody}\r\n */\r\nexport class ValidationError extends ErrorWithBody {\r\n    constructor(error, message = 'ValidationError') {\r\n        super(422, error, message);\r\n    }\r\n}\r\n\r\n/**\r\n * TooManyRequestsError\r\n *\r\n * @export\r\n * @class TooManyRequestsError\r\n * @extends {ErrorWithBody}\r\n */\r\nexport class TooManyRequestsError extends ErrorWithBody {\r\n    constructor(error, message = 'TooManyRequestsError') {\r\n        super(429, error, message);\r\n    }\r\n}\r\n\r\n/**\r\n * BadGateway\r\n *\r\n * @export\r\n * @class BadGateway\r\n * @extends {Error}\r\n */\r\nexport class BadGateway extends Error {\r\n    constructor() {\r\n        super('Bad gateway');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'Bad gateway';\r\n        this.http_code = 502;\r\n    }\r\n}\r\n\r\n/**\r\n * ApiError\r\n *\r\n * @export\r\n * @class HttpError\r\n * @extends {Error}\r\n */\r\nexport class ApiError extends Error {\r\n    constructor(http_code, message) {\r\n        super('API Error');\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'API Error';\r\n        this.http_code = http_code;\r\n        this.body = message;\r\n    }\r\n}\r\n\r\n/**\r\n * ValueError\r\n *\r\n * @export\r\n * @class ValueError\r\n * @extends {Error}\r\n */\r\nexport class ValueError extends Error {\r\n    constructor(message) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = 'ValueError';\r\n        this.body = message;\r\n    }\r\n}\r\n\r\nexport const determineError = async (err) => {\r\n    // Fot time outs\r\n    if (err.type === 'request-timeout') {\r\n        return new ApiTimeout();\r\n    }\r\n\r\n    if (err instanceof ValueError) {\r\n        throw err;\r\n    }\r\n\r\n    // For 'no body' response, replace with empty object\r\n    let errorJSON = err.json !== undefined ? err.json : {};\r\n\r\n    if (Object.keys(errorJSON).length > 0 && errorJSON.code === 'ECONNABORTED') {\r\n        return new ApiTimeout();\r\n    }\r\n\r\n    if (Object.keys(errorJSON).length === 0 && err.message) {\r\n        errorJSON = err.message;\r\n    }\r\n\r\n    switch (err.status) {\r\n        case 401:\r\n            return new AuthenticationError();\r\n        case 404:\r\n            return new NotFoundError();\r\n        case 403:\r\n            return new ActionNotAllowed();\r\n        case 409:\r\n            return new UrlAlreadyRegistered(await errorJSON);\r\n        case 422:\r\n            return new ValidationError(await errorJSON);\r\n        case 429:\r\n            return new TooManyRequestsError(await errorJSON);\r\n        case 502:\r\n            return new BadGateway();\r\n        default: {\r\n            return new ApiError(err.status, await errorJSON);\r\n        }\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]}